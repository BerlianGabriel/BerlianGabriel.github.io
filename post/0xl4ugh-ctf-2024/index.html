<!doctype html>
































<html
  class="not-ready lg:text-base"
  style="--bg: #fbfbfb"
  lang="en"
>
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>All Cryptography Challenges in 0xL4ugh CTF 2024 - Berlian Gabriel</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="L4ugh To solve this challenge we need to obtain both d_evil and d_good. There is a mathematical correlation between d_evil and d_good which can be used to obtain d. This d value is needed to enter the AES section and obtain the flag.
1st Step: Obtaining d_evil We got this output from the program
option: {&quot;option&quot;: &quot;1&quot;} Ns=[63177871485525088951181443705081041461634543859522117456351661402080497656013624345546070712850495609948764684183439400179805537891875164625989052253083230659226521596768360072707440507270327177188344955333689656692052942117636523598888566332378334484989635662511781875819463942251573589312702111067666695137, 68417337722533900652500729977779356663072309260168978032066078964139516598349612942585273964747232440917208024070944878746826859130026151601011616528313228935586842217368126736111151916711142015199565420639331316508069640571601570035232358801113829472768752560859144386001410351637727931231353571569134609613, 168215881121069104898729985793627403151351981328884254464192670823030720417667002544672696986252246417961681145401431457093773120629615493457032091565389427445918129884222127717793599651891523817691046412371891919053448963038240278703665244310516285574823513905266879981762459903701984822492196244463862082391] es=[12582085533392574037164768248411138060403343393202613693550614803000172294230368141692552003822419391035797084039299201901512976645994807330716118571915746013990494151810672823831168856260922412164054599692289888776400447431070962333675221317644750501553797025822331524893012554824564175094394720928485195797, 52991328407753481067902974746673138076572011687788467203911629995517206407307922740860404612421208610353519701472906794085957060352155035124317720744806171291972518225378971560363131225736966114292306895861938499450530895659529573837086398127260636837343320713697820328407358447537105167261121423215194249369, 12716000118173422228503985827797768395368925658432766439952368872498203791862354466845685008653376234224733294978052658757583825714636644392177238952806721471327627920018233106907442613769777864456001744370303817106405311946809104397220107151351200204233662456907101573711002774913538347184439597239543099945] We are in a situation where we have a few public key pairs that were derived from the same private exponent (d_evil)." />
  <meta name="author" content="Berlian Gabriel" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="https://berliangabriel.github.io/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="https://berliangabriel.github.io/theme.png" />

  
  
  
  
  

  
  
  <link rel="preload" as="image" href="https://berliangabriel.github.io/twitter.svg" />
  
  <link rel="preload" as="image" href="https://berliangabriel.github.io/linkedin.svg" />
  
  

  
  
  <script
    defer
    src="https://berliangabriel.github.io/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="https://berliangabriel.github.io/favicon.ico" />
  <link rel="apple-touch-icon" href="https://berliangabriel.github.io/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.92.2" />

  
  
  
  
  
  <meta itemprop="name" content="All Cryptography Challenges in 0xL4ugh CTF 2024">
<meta itemprop="description" content="L4ugh To solve this challenge we need to obtain both d_evil and d_good. There is a mathematical correlation between d_evil and d_good which can be used to obtain d. This d value is needed to enter the AES section and obtain the flag.
1st Step: Obtaining d_evil We got this output from the program
option: {&quot;option&quot;: &quot;1&quot;} Ns=[63177871485525088951181443705081041461634543859522117456351661402080497656013624345546070712850495609948764684183439400179805537891875164625989052253083230659226521596768360072707440507270327177188344955333689656692052942117636523598888566332378334484989635662511781875819463942251573589312702111067666695137, 68417337722533900652500729977779356663072309260168978032066078964139516598349612942585273964747232440917208024070944878746826859130026151601011616528313228935586842217368126736111151916711142015199565420639331316508069640571601570035232358801113829472768752560859144386001410351637727931231353571569134609613, 168215881121069104898729985793627403151351981328884254464192670823030720417667002544672696986252246417961681145401431457093773120629615493457032091565389427445918129884222127717793599651891523817691046412371891919053448963038240278703665244310516285574823513905266879981762459903701984822492196244463862082391] es=[12582085533392574037164768248411138060403343393202613693550614803000172294230368141692552003822419391035797084039299201901512976645994807330716118571915746013990494151810672823831168856260922412164054599692289888776400447431070962333675221317644750501553797025822331524893012554824564175094394720928485195797, 52991328407753481067902974746673138076572011687788467203911629995517206407307922740860404612421208610353519701472906794085957060352155035124317720744806171291972518225378971560363131225736966114292306895861938499450530895659529573837086398127260636837343320713697820328407358447537105167261121423215194249369, 12716000118173422228503985827797768395368925658432766439952368872498203791862354466845685008653376234224733294978052658757583825714636644392177238952806721471327627920018233106907442613769777864456001744370303817106405311946809104397220107151351200204233662456907101573711002774913538347184439597239543099945] We are in a situation where we have a few public key pairs that were derived from the same private exponent (d_evil)."><meta itemprop="datePublished" content="2024-02-10T22:18:48+08:00" />
<meta itemprop="dateModified" content="2024-02-10T22:18:48+08:00" />
<meta itemprop="wordCount" content="831">
<meta itemprop="keywords" content="" />
  
  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="All Cryptography Challenges in 0xL4ugh CTF 2024"/>
<meta name="twitter:description" content="L4ugh To solve this challenge we need to obtain both d_evil and d_good. There is a mathematical correlation between d_evil and d_good which can be used to obtain d. This d value is needed to enter the AES section and obtain the flag.
1st Step: Obtaining d_evil We got this output from the program
option: {&quot;option&quot;: &quot;1&quot;} Ns=[63177871485525088951181443705081041461634543859522117456351661402080497656013624345546070712850495609948764684183439400179805537891875164625989052253083230659226521596768360072707440507270327177188344955333689656692052942117636523598888566332378334484989635662511781875819463942251573589312702111067666695137, 68417337722533900652500729977779356663072309260168978032066078964139516598349612942585273964747232440917208024070944878746826859130026151601011616528313228935586842217368126736111151916711142015199565420639331316508069640571601570035232358801113829472768752560859144386001410351637727931231353571569134609613, 168215881121069104898729985793627403151351981328884254464192670823030720417667002544672696986252246417961681145401431457093773120629615493457032091565389427445918129884222127717793599651891523817691046412371891919053448963038240278703665244310516285574823513905266879981762459903701984822492196244463862082391] es=[12582085533392574037164768248411138060403343393202613693550614803000172294230368141692552003822419391035797084039299201901512976645994807330716118571915746013990494151810672823831168856260922412164054599692289888776400447431070962333675221317644750501553797025822331524893012554824564175094394720928485195797, 52991328407753481067902974746673138076572011687788467203911629995517206407307922740860404612421208610353519701472906794085957060352155035124317720744806171291972518225378971560363131225736966114292306895861938499450530895659529573837086398127260636837343320713697820328407358447537105167261121423215194249369, 12716000118173422228503985827797768395368925658432766439952368872498203791862354466845685008653376234224733294978052658757583825714636644392177238952806721471327627920018233106907442613769777864456001744370303817106405311946809104397220107151351200204233662456907101573711002774913538347184439597239543099945] We are in a situation where we have a few public key pairs that were derived from the same private exponent (d_evil)."/>

  
  
  
  <link rel="canonical" href="https://berliangabriel.github.io/post/0xl4ugh-ctf-2024/" />
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="https://berliangabriel.github.io"
      >Berlian Gabriel</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  
  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#fbfbfb'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    
    <nav class="lg:ml-12 lg:flex lg:flex-row lg:items-center lg:space-x-6">
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/about/"
        >About</a
      >
      
      <a
        class="block text-center text-2xl leading-[5rem] lg:text-base lg:font-normal"
        href="/contact/"
        >Contact</a
      >
      
    </nav>
    

    
    <nav
      class="mt-12 flex justify-center space-x-10 dark:invert lg:ml-12 lg:mt-0 lg:items-center lg:space-x-6"
    >
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./twitter.svg)"
        href="https://twitter.com/BerlianGM"
        target="_blank"
        rel="me"
      >
        twitter
      </a>
      
      <a
        class="h-8 w-8 text-[0] [background:var(--url)_center_center/cover_no-repeat] lg:h-6 lg:w-6"
        style="--url: url(./linkedin.svg)"
        href="https://linkedin.com/in/Berlian-Gabriel-Mongkoginta"
        target="_blank"
        rel="me"
      >
        linkedin
      </a>
      
    </nav>
    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">All Cryptography Challenges in 0xL4ugh CTF 2024</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Feb 10, 2024</time>
      
      
      
      
    </div>
    
  </header>

  <section><h1 id="l4ugh">L4ugh</h1>
<p>To solve this challenge we need to obtain both d_evil and d_good. There is a mathematical correlation between d_evil and d_good which can be used to obtain d. This d value is needed to enter the AES section and obtain the flag.</p>
<h2 id="1st-step-obtaining-d_evil">1st Step: Obtaining d_evil</h2>
<p>We got this output from the program</p>
<pre tabindex="0"><code>option: {&quot;option&quot;: &quot;1&quot;}
Ns=[63177871485525088951181443705081041461634543859522117456351661402080497656013624345546070712850495609948764684183439400179805537891875164625989052253083230659226521596768360072707440507270327177188344955333689656692052942117636523598888566332378334484989635662511781875819463942251573589312702111067666695137, 68417337722533900652500729977779356663072309260168978032066078964139516598349612942585273964747232440917208024070944878746826859130026151601011616528313228935586842217368126736111151916711142015199565420639331316508069640571601570035232358801113829472768752560859144386001410351637727931231353571569134609613, 168215881121069104898729985793627403151351981328884254464192670823030720417667002544672696986252246417961681145401431457093773120629615493457032091565389427445918129884222127717793599651891523817691046412371891919053448963038240278703665244310516285574823513905266879981762459903701984822492196244463862082391]
es=[12582085533392574037164768248411138060403343393202613693550614803000172294230368141692552003822419391035797084039299201901512976645994807330716118571915746013990494151810672823831168856260922412164054599692289888776400447431070962333675221317644750501553797025822331524893012554824564175094394720928485195797, 52991328407753481067902974746673138076572011687788467203911629995517206407307922740860404612421208610353519701472906794085957060352155035124317720744806171291972518225378971560363131225736966114292306895861938499450530895659529573837086398127260636837343320713697820328407358447537105167261121423215194249369, 12716000118173422228503985827797768395368925658432766439952368872498203791862354466845685008653376234224733294978052658757583825714636644392177238952806721471327627920018233106907442613769777864456001744370303817106405311946809104397220107151351200204233662456907101573711002774913538347184439597239543099945]
</code></pre><p>We are in a situation where we have a few public key pairs that were derived from the same private exponent (d_evil). This situation allows us to use Common Private Exponent Attack on RSA. We will be implementing this paper (<a href="https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf">https://www.ijcsi.org/papers/IJCSI-9-2-1-311-314.pdf</a>) and using LLL to retrieve d_evil.</p>
<p>Solver to obtain d_evil (credit to <a href="https://github.com/ctfcompfest/compfest13-final/blob/master/cryptography/private/writeup/solve.py)">https://github.com/ctfcompfest/compfest13-final/blob/master/cryptography/private/writeup/solve.py)</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> pwn <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
<span style="color:#f92672">import</span> gmpy2
<span style="color:#f92672">import</span> os

Ns<span style="color:#f92672">=</span>[] <span style="color:#75715e">#fill with the output for Ns</span>
es<span style="color:#f92672">=</span>[] <span style="color:#75715e">#fill with the output for es</span>

<span style="color:#66d9ef">def</span> <span style="color:#a6e22e">encrypt</span>():
    e<span style="color:#f92672">=</span>es<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
    n<span style="color:#f92672">=</span>Ns<span style="color:#f92672">.</span>pop(<span style="color:#ae81ff">0</span>)
    <span style="color:#66d9ef">return</span> [e, n]

public_keys <span style="color:#f92672">=</span> []
r <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>
i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
<span style="color:#66d9ef">while</span> i <span style="color:#f92672">&lt;</span> r:
    public_keys<span style="color:#f92672">.</span>append(encrypt())
    print(public_keys)
    public_keys <span style="color:#f92672">=</span> sorted(public_keys, key<span style="color:#f92672">=</span><span style="color:#66d9ef">lambda</span> x : x[<span style="color:#ae81ff">1</span>])
    i <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>

<span style="color:#75715e"># create the matrix</span>
M <span style="color:#f92672">=</span> int(gmpy2<span style="color:#f92672">.</span>iroot(public_keys[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>][<span style="color:#ae81ff">1</span>], <span style="color:#ae81ff">2</span>)[<span style="color:#ae81ff">0</span>])
matrix <span style="color:#f92672">=</span> [[<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> j <span style="color:#f92672">in</span> range(r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)] <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(r <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>)]
matrix[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>] <span style="color:#f92672">=</span> M
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(r):
    matrix[<span style="color:#ae81ff">0</span>][i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> public_keys[i][<span style="color:#ae81ff">0</span>]
    matrix[i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>][i <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>] <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>public_keys[i][<span style="color:#ae81ff">1</span>]

matrix <span style="color:#f92672">=</span> str(matrix)<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>)
f <span style="color:#f92672">=</span> open(<span style="color:#e6db74">&#39;matrix&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>)
f<span style="color:#f92672">.</span>write(matrix)
f<span style="color:#f92672">.</span>close()

<span style="color:#75715e"># using fplll (https://github.com/fplll/fplll)</span>
res <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>popen(<span style="color:#e6db74">&#39;fplll -a lll matrix&#39;</span>)<span style="color:#f92672">.</span>read()
b1 <span style="color:#f92672">=</span> int(res<span style="color:#f92672">.</span>split(<span style="color:#e6db74">&#39; &#39;</span>)[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">2</span>:])
os<span style="color:#f92672">.</span>system(<span style="color:#e6db74">&#39;rm matrix&#39;</span>)

<span style="color:#75715e"># getting the d_evil</span>
d <span style="color:#f92672">=</span> abs(b1) <span style="color:#f92672">//</span> M
print(d)
</code></pre></div><p>From the script above we got <code>d_evil=15178928444351843699309490354280811018710625016309041634424791660221523247493518326239884724658824489</code></p>
<h2 id="2nd-step-obtaining-d_good">2nd Step: Obtaining d_good</h2>
<p>use this for the payload on option 2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">1</span>]: x<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>

In [<span style="color:#ae81ff">2</span>]: x
Out[<span style="color:#ae81ff">2</span>]: <span style="color:#ae81ff">17498005798264095394980017816940970922825355447145699491406164851279623993595007385788105416184430591</span>
</code></pre></div><p>we then got this output from the program:</p>
<pre tabindex="0"><code>option: {&quot;option&quot;: &quot;2&quot;}
Enter your payload:     17498005798264095394980017816940970922825355447145699491406164851279623993595007385788105416184430591
RAND = [236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547831550342738774045316773280866091695446555852126352261762151935447363669066696571953760841997886810224, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547831978001113528054845433793564342301369403819891212871861733740351443965662510091142231166518463984432, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547834573620656556633444479386223647444145452246465656292651471470587267389462826706178501708679988894040, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547830458367721061450157017808834830853014602341868622253795672294331059172859536863933208752474837334210, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547835863401476210545765230993750990148889920960508669945911446189664075442943544834378273711469603796160, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547830752414266487317045433007344385646731648362492228071917510674569518792152296095476933455779708230618, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547834129533080478819072535935108652813110595833861849865643800296119832747279784391057749343996635720940, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547835056336646694300076691426438853974708824037294539111393818963969884213464482405390522048764250780194, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547831362700797094853489150774772826437443409299735933567134426737128681242448286707292262166570548912028, 236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547835268414443436134619838420217416506307772744338173950848314756256619167466069287906334543879625933212]
</code></pre><p>Each value in RAND was calculated as follow:</p>
<pre tabindex="0"><code>d_good*user_input + getPrime(666//2)
</code></pre><p>Notice that earlier we keyed in x = 2^333 - 1, as the user_input. Since x is not prime we can conclude that x &gt; getPrime(666//2), which means we can retrieve d_good by dividing and flooring a value from RAND with x. We actually only need 1 value from RAND[], so after taking just the first value, we can obtain d_good as follow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">d_good<span style="color:#f92672">=</span><span style="color:#ae81ff">236295022344045481022088596152868031855245900838697652659839869299879993102103237926140027016777547831550342738774045316773280866091695446555852126352261762151935447363669066696571953760841997886810224</span><span style="color:#f92672">//</span>x
</code></pre></div><h2 id="3rd-step-obtaining-d">3rd Step: Obtaining d</h2>
<p>From source code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">seed <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;It&#39;s (666) the work of the devil...&#34;</span>
d_evil <span style="color:#f92672">=</span> d <span style="color:#f92672">&gt;&gt;</span> (int(seed[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">9</span>])<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>)
d_good <span style="color:#f92672">=</span> d <span style="color:#f92672">%</span>  pow(<span style="color:#ae81ff">2</span>,int(seed[<span style="color:#ae81ff">6</span>:<span style="color:#ae81ff">9</span>])<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>)
</code></pre></div><p>Mathematically, we have:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">d_good <span style="color:#f92672">=</span> d <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span>
d <span style="color:#f92672">=</span> k <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span> <span style="color:#f92672">+</span> d_good

d_evil <span style="color:#f92672">=</span> d <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span>
d <span style="color:#f92672">=</span> d_evil <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span> <span style="color:#f92672">+</span> reminder

<span style="color:#75715e">#notice that k = d_evil and reminder = d_good</span>
d <span style="color:#f92672">=</span> d_evil <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span><span style="color:#ae81ff">333</span> <span style="color:#f92672">+</span> d_good
</code></pre></div><p>We can obtain the value for d as follow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">1</span>]: pow(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">333</span>)<span style="color:#f92672">*</span>d_evil <span style="color:#f92672">+</span> d_good
Out[<span style="color:#ae81ff">1</span>]: <span style="color:#ae81ff">265600977930704366505391758369563164412146232168800460268090387566150924418088529060040292126172260512385738121219390367812214338171890978746977883577350038164691811235185496713171580031944115211005489</span>
</code></pre></div><p>After submitting this d value, we can then move the next section on AES. We got this output from the program:</p>
<pre tabindex="0"><code>option: {&quot;option&quot;: &quot;3&quot;,&quot;d&quot;: &quot;265600977930704366505391758369563164412146232168800460268090387566150924418088529060040292126172260512385738121219390367812214338171890978746977883577350038164691811235185496713171580031944115211005489&quot;}
1.get your token
2.sign in{&quot;option&quot;: &quot;1&quot;,&quot;user&quot;: &quot;amin&quot;}
{'id': 792666, 'isadmin': False, 'username': 'amin'}
f05b78ef2ee3cd0a6302eb7f15bc221e2486a985e318129e987a524a15ffffe03d50988597ad5f659b8d7dd2f0b55a2834ce4784f0ce7894ffecf645af139ad9a34cc0f3f1f4beab6b44fb934f8187a1
</code></pre><h2 id="step-4-aes-bit-flipping-attack">Step 4: AES Bit-flipping Attack</h2>
<p>Notice that in the source code, we can see that the <code>iv</code> is user-controlled, and <code>isadmin</code> is being checked if it evaluates to <code>True</code>, on top of additional check that the data has to be a dictionary. Our goal is to tamper with the decryption result such that it will give the output of <code>b'{&quot;isadmin&quot;:1}\x03\x03\x03'</code>, making sure that we satisfy the unpad function. If we were to use <code>b'{&quot;isadmin&quot;:True}'</code> which has the length of 16 bytes, we will be met with unpad error, and we do not want to use more than 1 block in this attack.</p>
<p>We discarded the remaining blocks on the ciphertext to avoid format error on the dictionary during decryption when XOR-ed with the <code>new_iv</code>. This is made possible due to the fact the code only checks for <code>isadmin=True</code>. We can achieve this by inputting a modified <code>iv</code> value appended with the ciphertext that has been trimmed, as follow:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">In [<span style="color:#ae81ff">1</span>]: ct<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;f05b78ef2ee3cd0a6302eb7f15bc221e2486a985e318129e987a524a15ffffe03d50988597ad5f659b8d7dd2f0b55a2834ce4784f0ce7894ffecf645af139ad9a34cc0f3f1f4beab6b44fb934f8187a1&#39;</span>

In [<span style="color:#ae81ff">2</span>]: data<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#ae81ff">792666</span>, <span style="color:#e6db74">&#39;isadmin&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;username&#39;</span>: <span style="color:#e6db74">&#39;amin&#39;</span>}

In [<span style="color:#ae81ff">3</span>]: pt <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>dumps(data)

In [<span style="color:#ae81ff">4</span>]: iv<span style="color:#f92672">=</span>bytes<span style="color:#f92672">.</span>fromhex(ct[:<span style="color:#ae81ff">32</span>])

In [<span style="color:#ae81ff">5</span>]: new_iv<span style="color:#f92672">=</span>xor(xor(iv, pt[:<span style="color:#ae81ff">16</span>]<span style="color:#f92672">.</span>encode()),<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;{&#34;isadmin&#34;:1}</span><span style="color:#ae81ff">\x03\x03\x03</span><span style="color:#e6db74">&#39;</span>)

In [<span style="color:#ae81ff">6</span>]: new_iv<span style="color:#f92672">.</span>hex()<span style="color:#f92672">+</span>ct[<span style="color:#ae81ff">32</span>:<span style="color:#ae81ff">64</span>]
Out[<span style="color:#ae81ff">6</span>]: <span style="color:#e6db74">&#39;f05b78f86dbd80543412e7785e93013f2486a985e318129e987a524a15ffffe0&#39;</span>
</code></pre></div><p>After inputting the tampered token, we can obtain the flag.</p>
<pre tabindex="0"><code>1.get your token
2.sign in{&quot;option&quot;: &quot;2&quot;,&quot;token&quot;: &quot;f05b78f86dbd80543412e7785e93013f2486a985e318129e987a524a15ffffe0&quot;}
Decrypted plaintext: {&quot;isadmin&quot;:1}
1. Get Flag
2.Exit
1. Get Flag
2.Exit
{&quot;option&quot;: &quot;1&quot;}
0xL4ugh{cryptocats_B3b0_4nd_M1ndfl4y3r}
</code></pre><p>FLAG: <code>0xL4ugh{cryptocats_B3b0_4nd_M1ndfl4y3r}</code></p>
<h2 id="poison">Poison</h2>
<p>We can solve this in sage. After inputting the necessary ECC functions and the values from output.txt in sage, we can do the following:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sage: my_prev<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>
<span style="color:#f92672">....</span>: <span style="color:#66d9ef">for</span> bit <span style="color:#f92672">in</span> range(len(decs)):
<span style="color:#f92672">....</span>:     dec0,dec1<span style="color:#f92672">=</span>decs[bit]
<span style="color:#f92672">....</span>:     m0,m1<span style="color:#f92672">=</span>ms[bit]
<span style="color:#f92672">....</span>:     c10,c11<span style="color:#f92672">=</span>C1s[bit]
<span style="color:#f92672">....</span>:     <span style="color:#66d9ef">if</span>(E(m0,m1)<span style="color:#f92672">+</span>E(c10,c11)<span style="color:#f92672">*</span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span>bit <span style="color:#f92672">==</span> E(dec0,dec1)):
<span style="color:#f92672">....</span>:         my_prev<span style="color:#f92672">=</span>my_prev<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span><span style="color:#f92672">^</span>bit
<span style="color:#f92672">....</span>: print(long_to_bytes(my_prev))
<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;f4u1ty_3CC_EG_CR4CK3r!!!&#39;</span>
</code></pre></div><p>FLAG: <code>0xL4ugh{f4u1ty_3CC_EG_CR4CK3r!!!}</code></p>
<h2 id="rsa-gcd">RSA-GCD</h2>
<p>We can simplify the equation and use GCD to find q in sage</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sage: <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">10000</span>):
<span style="color:#f92672">....</span>:     q <span style="color:#f92672">=</span> gcd((pow(eq1<span style="color:#f92672">-</span>i,power2,n)<span style="color:#f92672">*</span>pow(<span style="color:#ae81ff">2</span>,power1<span style="color:#f92672">*</span>power2,n))<span style="color:#f92672">%</span>n <span style="color:#f92672">-</span> pow(out2,power1,n), n)
<span style="color:#f92672">....</span>:     <span style="color:#66d9ef">if</span> q <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>:
<span style="color:#f92672">....</span>:         print(q)
<span style="color:#f92672">....</span>:         <span style="color:#66d9ef">break</span>
</code></pre></div><p>we got <code>q = 99622030507522927271735666834103303832522359573060498989068335242789278465325103785545103897816594347523515551196878710170582246653480199709318964288210307717514969090267733855006018150061461355814364360355472347448893613585520966150648509610088163303326395218402257442573144208980129905892885327340996802261</code></p>
<p>we can then decrypt the ciphertext</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">p<span style="color:#f92672">=</span>n<span style="color:#f92672">//</span>q
d<span style="color:#f92672">=</span>inverse_mod(eq1,(p<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>))
long_to_bytes(pow(c,d,n))
</code></pre></div><p>FLAG: <code>0xL4ugh{you_know_how_factor_N!}</code></p>
<p>Thanks for reading! Follow me on twitter <a href="https://twitter.com/BerlianGM">https://twitter.com/BerlianGM</a></p>
</section>

  
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    
    <a
      class="ml-auto flex w-1/2 items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="https://berliangabriel.github.io/post/mapna-ctf-2024/"
      ><span>Mapna CTF 2024</span><span class="ml-1.5">→</span></a
    >
    
  </nav>
  
  

  
  

  
  

  
  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="https://berliangabriel.github.io">Berlian Gabriel</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
